{{- /* defaults */ -}}
{{- $hostname := .chezmoi.hostname -}}
{{- $headless := not stdinIsATTY -}}
{{- $ephemeral := false -}}
{{- $personal := true -}}
{{- $email := "alexanderbuescher@outlook.com" -}}

{{/* detect GitHub Codespaces, VSCode devcontainers, CI */}}
{{- if or (env "CODESPACES") (env "REMOTE_CONTAINERS_IPC") (env "CI") -}}
  {{- $ephemeral = true -}}
  {{- $headless = true -}}
{{- end -}}

{{- /* prompt only when interactive and not pre-marked ephemeral */ -}}
{{- if and (not $ephemeral) (stdinIsATTY) -}}
  {{- $headless  = promptBoolOnce . "headless"  "Headless (no prompts)" -}}
  {{- $ephemeral = promptBoolOnce . "ephemeral" "Ephemeral environment" -}}
  {{- $personal  = promptBoolOnce . "personal"  "Is this a personal machine" -}}
  {{- $email     = promptStringOnce . "email"   "Email address" -}}
{{- end -}}

{{- /* if non-personal and still interactive, offer a work email once */ -}}
{{- if and (not $personal) (not $headless) -}}
  {{- $email = promptStringOnce . "workEmail" "Work email address" -}}
{{- else if not $personal -}}
  {{- $email = "you@company.com" -}}
{{- end -}}

{{- /* keep osID for troubleshooting */ -}}
{{- $osID := .chezmoi.os -}}
{{- if and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id") -}}
  {{- $osID = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

data:
  personal: {{ $personal }}
  email: {{ $email | quote }}
  headless: {{ $headless }}
  ephemeral: {{ $ephemeral }}
  osid: {{ $osID | quote }}
  hostname: {{ $hostname | quote }}
