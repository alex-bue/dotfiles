# Enable colors and change prompt:
autoload -U colors && colors	# Load colors

# install plugin manager (zinit)
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"

# opts
HISTFILE="$ZDOTDIR/.zsh_history"
HISTSIZE=5000                    # Maximum events for internal history
SAVEHIST=5000                    # Maximum events in history file

setopt appendhistory             # Append rather than overwrite
setopt share_history             # Share history between all sessions.
setopt hist_ignore_space         # Do not record an event starting with a space.
setopt hist_expire_dups_first    # Expire a duplicate event first when trimming history.
setopt hist_ignore_dups          # Do not record an event that was just recorded again.
setopt hist_ignore_all_dups      # Delete an old recorded event if a new event is a duplicate.
setopt hist_find_no_dups         # Do not display a previously found event.
setopt hist_save_no_dups         # Do not write a duplicate event to the history file.
setopt hist_verify               # Do not execute immediately upon history expansion.

# completions
autoload -Uz compinit && compinit

zinit cdreplay -q

zstyle ':completion:*' menu no                              # Disable zsh complete menus (because plugin handles them)
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}'   # Case insensitive completion
zstyle ':completion:*' list-colors "${(s.:.)LS_COLORS}"     # Color the completions
zstyle ':fzf-tab:*' fzf-bindings 'tab:accept' # Use tab as enter instead of going down the list
zstyle ':fzf-tab:complete:cd:*' fzf-preview 'ls --color $realpath' # Use fzf tab for cd completions

#TODO: Do I need these?
# zmodload zsh/complist
# compinit -C
# _comp_options+=(globdots)       # Complete hidden(dot)files

# load modules
[ -f "$ZDOTDIR/aliases.zsh" ] && source "$ZDOTDIR/aliases.zsh"
[ -f "$ZDOTDIR/keybindings.zsh" ] && source "$ZDOTDIR/keybindings.zsh"

# add zsh plugins
zinit light Aloxaf/fzf-tab
zinit light zsh-users/zsh-syntax-highlighting
zinit light zsh-users/zsh-completions
zinit light zsh-users/zsh-autosuggestions

# editor and prompt config
export NVIM_APPNAME="lazyvim"
export EDITOR="nvim"
export VISUAL="nvim"
export STARSHIP_CONFIG=~/.config/starship/starship.toml # Starship config

# load programs
eval "$(fzf --zsh)"
eval "$(zoxide init zsh)"
eval "$(starship init zsh)"
